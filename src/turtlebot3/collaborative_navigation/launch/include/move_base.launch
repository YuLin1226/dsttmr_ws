<launch>

  <!-- COMMON -->
  <arg name="no_static_map" default="false"/>
  <arg name="way_points_navigation" default="false"/>

  <!-- 1ST ROBOT -->
    <!-- set frame_id -->
    <arg name="first_global_frame_id" default="map"/>
    <arg name="first_odom_frame_id" default="odom"/>
    <arg name="first_base_frame_id" default="base_link"/>
    <!-- set topics -->
    <arg name="first_map_topic" default="/map" />
    <arg name="first_odom_topic" default="odom" />
    <arg name="first_cmd_vel_topic" default="cmd_vel" />
    <!-- planners, costmaps, etc -->
    <node pkg="move_base" type="move_base" name="first_move_base" respawn="true" output="screen" clear_params="true">
      <rosparam file="$(dirname)/../../config/move_base/costmap_common_params.yaml" command="load" ns="global_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/costmap_common_params.yaml" command="load" ns="local_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/local_costmap_params.yaml" command="load" ns="local_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/global_costmap_params.yaml" command="load" ns="global_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/planners.yaml" command="load" />
      <rosparam file="$(dirname)/../../config/move_base/controllers.yaml" command="load" />
      <rosparam file="$(dirname)/../../config/move_base/recovery_behaviors.yaml" command="load" />

      <!-- reset frame_id parameters using user input data -->
      <param name="global_costmap/global_frame" value="$(arg first_global_frame_id)" unless="$(arg no_static_map)" />
      <param name="global_costmap/global_frame" value="$(arg first_odom_frame_id)" if="$(arg no_static_map)" />
      <param name="global_costmap/robot_base_frame" value="$(arg first_base_frame_id)"/>
      <param name="global_costmap/width" value="100.0" if="$(arg no_static_map)"/>
      <param name="global_costmap/height" value="100.0" if="$(arg no_static_map)"/>
      <param name="global_costmap/static_layer/map_topic" value="$(arg first_map_topic)" unless="$(arg way_points_navigation)"/>
      <param name="global_costmap/static_layer/map_topic" value="/modified_map" if="$(arg way_points_navigation)"/>
      <param name="local_costmap/global_frame" value="$(arg first_odom_frame_id)"/>
      <param name="local_costmap/robot_base_frame" value="$(arg first_base_frame_id)"/>
      <param name="TebLocalPlannerROS/odom_topic" value="$(arg first_odom_topic)"/>
      <param name="TebLocalPlannerROS/map_frame" value="$(arg first_odom_frame_id)"/>

      <remap from="map" to="$(arg first_map_topic)" />
      <remap from="odom" to="$(arg first_odom_topic)"/>
      <remap from="cmd_vel" to="$(arg first_cmd_vel_topic)"/>
    </node>



  <!-- 2ND ROBOT -->
    <!-- set frame_id -->
    <arg name="second_global_frame_id" default="map"/>
    <arg name="second_odom_frame_id" default="odom"/>
    <arg name="second_base_frame_id" default="base_link"/>
    <!-- set topics -->
    <arg name="second_map_topic" default="/map" />
    <arg name="second_odom_topic" default="odom" />
    <arg name="second_cmd_vel_topic" default="cmd_vel" />
    <!-- planners, costmaps, etc -->
    <node pkg="move_base" type="move_base" name="second_move_base" respawn="true" output="screen" clear_params="true">
      <rosparam file="$(dirname)/../../config/move_base/costmap_common_params.yaml" command="load" ns="global_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/costmap_common_params.yaml" command="load" ns="local_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/local_costmap_params.yaml" command="load" ns="local_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/global_costmap_params.yaml" command="load" ns="global_costmap" />
      <rosparam file="$(dirname)/../../config/move_base/planners.yaml" command="load" />
      <rosparam file="$(dirname)/../../config/move_base/controllers.yaml" command="load" />
      <rosparam file="$(dirname)/../../config/move_base/recovery_behaviors.yaml" command="load" />

      <!-- reset frame_id parameters using user input data -->
      <param name="global_costmap/global_frame" value="$(arg second_global_frame_id)" unless="$(arg no_static_map)" />
      <param name="global_costmap/global_frame" value="$(arg second_odom_frame_id)" if="$(arg no_static_map)" />
      <param name="global_costmap/robot_base_frame" value="$(arg second_base_frame_id)"/>
      <param name="global_costmap/width" value="100.0" if="$(arg no_static_map)"/>
      <param name="global_costmap/height" value="100.0" if="$(arg no_static_map)"/>
      <param name="global_costmap/static_layer/map_topic" value="$(arg second_map_topic)" unless="$(arg way_points_navigation)"/>
      <param name="global_costmap/static_layer/map_topic" value="/modified_map" if="$(arg way_points_navigation)"/>
      <param name="local_costmap/global_frame" value="$(arg second_odom_frame_id)"/>
      <param name="local_costmap/robot_base_frame" value="$(arg second_base_frame_id)"/>
      <param name="TebLocalPlannerROS/odom_topic" value="$(arg second_odom_topic)"/>
      <param name="TebLocalPlannerROS/map_frame" value="$(arg second_odom_frame_id)"/>

      <remap from="map" to="$(arg second_map_topic)" />
      <remap from="odom" to="$(arg second_odom_topic)"/>
      <remap from="cmd_vel" to="$(arg second_cmd_vel_topic)"/>
    </node>


</launch>
